<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>banana arcade</title>
<link rel="icon" href="https://cdn-icons-png.flaticon.com/512/6482/6482621.png">
<style>
:root {
  --bg:#121212;
  --panel:#1a1a1a;
  --yellow:#ffd84d;
  --text:#f2f2f2;
  --muted:#a0a0a0;
}
*{box-sizing:border-box;font-family:Inter,system-ui,sans-serif;}
body{margin:0;min-height:100vh;display:flex;flex-direction:column;background:radial-gradient(1200px 600px at top,#1f1f1f,var(--bg));color:var(--text);overflow-x:hidden;}
header{
  display:flex;
  align-items:center;
  gap:16px;
  padding:18px 24px;
  position:relative;
  z-index:20;
}
.logo{font-weight:800;}
.menu-btn{
  background:var(--panel);
  border:1px solid #2a2a2a;
  border-radius:12px;
  padding:8px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  z-index:25;
}
.menu-btn img{width:26px;height:26px;display:block;}
.menu-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  backdrop-filter:blur(10px);
  opacity:0;
  pointer-events:none;
  transition:.25s;
  z-index:10;
}
.menu-overlay.open{opacity:1;pointer-events:all;}
.menu-panel{
  position:absolute;
  top:80px;
  left:24px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.menu-panel a{
  display:flex;
  align-items:center;
  gap:12px;
  background:var(--panel);
  border:1px solid #2a2a2a;
  border-radius:14px;
  padding:12px 16px;
  color:var(--text);
  text-decoration:none;
}
.menu-panel a img{width:24px;height:24px;}
main{flex:1;display:flex;flex-direction:column;overflow:auto;padding:32px;}
.hero{text-align:center;padding:80px 20px;}
.wavy{font-size:clamp(3rem,7vw,5rem);font-weight:900;color:var(--yellow);}
.wavy span{display:inline-block;animation:wave 2.2s ease-in-out infinite;animation-delay:calc(var(--i)*.08s);}
@keyframes wave{0%,100%{transform:translateY(0)}50%{transform:translateY(-14px)}}
.hero p{max-width:600px;margin:24px auto;color:var(--muted);}
.hero button{background:var(--yellow);color:#000;border:none;padding:14px 28px;border-radius:999px;font-weight:600;cursor:pointer;}
.info-wrap{max-width:1100px;margin:64px auto 0;padding:0 16px;}
.info-bar{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:24px;}
.info-card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(0,0,0,.4));border-radius:18px;padding:24px;}
.info-card h3{color:var(--yellow);margin-top:0;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:24px;}
.card{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(0,0,0,.3));border-radius:18px;overflow:hidden;cursor:pointer;}
.card img{width:100%;height:140px;object-fit:cover;}
.card-title{padding:12px;text-align:center;font-weight:600;}
.game-page{display:flex;flex-direction:column;height:100vh;padding:16px;}
.game-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:8px;}
.icon-btn{display:flex;align-items:center;justify-content:center;background:var(--panel);border:1px solid #2a2a2a;border-radius:12px;padding:6px;cursor:pointer;}
.icon-btn img{width:24px;height:24px;}
.game-frame{flex:1 1 auto;border-radius:12px;overflow:hidden;}
.game-frame iframe{width:100%;height:100%;border:none;}
footer{text-align:center;padding:24px;color:var(--muted);font-size:.85rem;}
</style>
</head>
<body>

<header>
  <button class="menu-btn" onclick="toggleMenu()">
    <img src="https://cdn-icons-png.flaticon.com/512/6482/6482621.png" alt="Menu">
  </button>
  <div class="logo">banana arcade</div>
</header>

<div class="menu-overlay" id="menu">
  <div class="menu-panel">
    <a href="#/" onclick="toggleMenu()"><img src="https://i.postimg.cc/SQGGBxHV/home-(1).png">home</a>
    <a href="#/games" onclick="toggleMenu()"><img src="https://i.postimg.cc/7ZhXMrsL/game-controller.png">games</a>
  </div>
</div>

<main id="app"></main>
<footer>banana arcade</footer>

<script>
const GAME_JSON="https://raw.githubusercontent.com/bananaarcade/bananaarcade.github.io/refs/heads/main/games.json";
const INJECT_ONLY="https://";
const BLOCKED=["subway surfer","people playground","stone grass moving simulator","comments"];
let games=[];

function toggleMenu(){menu.classList.toggle("open");}
function getTime(){return new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});}

// Weather fetch
async function loadWeather(){
  try{
    const res = await fetch("https://api.open-meteo.com/v1/forecast?latitude=51.5074&longitude=-0.1278&current_weather=true");
    const data = await res.json();
    const temp = data.current_weather.temperature;
    const weatherEl = document.querySelector("#weather");
    if(weatherEl) weatherEl.textContent = `${temp}°C`;
  }catch(e){
    console.error("Weather fetch failed", e);
  }
}
loadWeather();
setInterval(loadWeather, 10*60*1000);

window.addEventListener("message", e=>{
  const d=e.data||{};
  if(d.type==='get'){e.source.postMessage({type:'response',key:d.key,value:localStorage.getItem(d.key)},'*');}
  if(d.type==='set'){localStorage.setItem(d.key,d.value);}
});

function storagePatch(html){return `
<script>
(function(){
const store={};
window.localStorage={
  getItem(k){parent.postMessage({type:'get',key:k},'*');return store[k]||null;},
  setItem(k,v){store.postMessage({type:'set',key:k,value:v},'*');store[k]=v;},
  removeItem(k){delete store[k];},
  clear(){for(let k in store)delete store[k];}
};
window.addEventListener("message",e=>{if(e.data?.type==='response')store[e.data.key]=e.data.value;});
})();
<\/script>`+html;
}

async function loadGames(){
  const res=await fetch(GAME_JSON);
  const data=await res.json();
  games=data.filter(g=>!BLOCKED.some(b=>g.name.toLowerCase().includes(b)));
  route();
}

function homePage(){
  return `
  <section class="hero">
  <div class="wavy">${"banana arcade".split("").map((c,i)=>`<span style="--i:${i}">${c===" "?"&nbsp;":c}</span>`).join("")}</div>
  <p>harry z was here!</p>
  <button onclick="location.hash='#/games'">browse games</button>
  <div class="info-wrap">
    <div class="info-bar">
      <div class="info-card"><h3>time</h3><p id="time">${getTime()}</p></div>
      <div class="info-card"><h3>weather</h3><p id="weather">loading…</p></div>
      <div class="info-card"><h3>games</h3><p>${games.length}</p></div>
    </div>
  </div>
  </section>`;
}

function gamesPage(){
  let html=`<div class="grid">`;
  games.forEach((g,i)=>{
    html+=`<div class="card" onclick="location.hash='#/game/${i}'"><img src="${g.image}"><div class="card-title">${g.name}</div></div>`;
  });
  html+='</div>';
  return html;
}

// Updated game page with 7-second loading bar
async function gamePage(i){
  const g = games[i];
  const id = "frame-" + Date.now();
  
  const html = `
  <div class="game-page">
    <div class="game-header">
      <button class="icon-btn" onclick="location.hash='#/games'"><img src="https://i.postimg.cc/K8dGmFCN/previous.png"></button>
      <button class="icon-btn" onclick="toggleFullscreen('${id}')"><img src="https://i.postimg.cc/Zn7m2hrn/fullscreen.png"></button>
    </div>
    <div class="game-frame" style="display:flex;flex-direction:column;align-items:center;justify-content:center;">
      <div id="loading-bar" style="width:70%;height:24px;border:1px solid #2a2a2a;border-radius:12px;overflow:hidden;background:#1a1a1a;margin-top:50px;">
        <div id="progress" style="width:0%;height:100%;background:var(--yellow);transition:width 0.1s linear;"></div>
      </div>
      <p id="loading-text" style="margin-top:12px;color:var(--muted);">Loading game…</p>
      <iframe id="${id}" src="about:blank" allowfullscreen style="width:100%;height:100%;display:none;border:none;border-radius:12px;"></iframe>
    </div>
  </div>`;
  
  document.getElementById("app").innerHTML = html;
  
  const iframe = document.getElementById(id);
  const progress = document.getElementById("progress");
  const loadingText = document.getElementById("loading-text");
  let loaded = false;
  
  let start = Date.now();
  const interval = setInterval(()=>{
    const elapsed = Date.now() - start;
    let percent = Math.min((elapsed/7000)*100,100);
    progress.style.width = percent + "%";
  },50);
  
  setTimeout(async()=>{
    try{
      const htmlContent = await fetch(g.url).then(r=>r.text());
      if(g.url.includes(INJECT_ONLY)){
        iframe.srcdoc = storagePatch(htmlContent);
      } else {
        iframe.src = g.url;
      }
      iframe.onload = () => {
        loaded = true;
        iframe.style.display = "block";
        progress.parentElement.style.display = "none";
        clearInterval(interval);
      };
    }catch{
      iframe.src = g.url;
    }
  },50);
  
  setTimeout(()=>{
    if(!loaded){
      loadingText.textContent = "The game should not be taking this long to load. Try refreshing with Ctrl+Shift+R.";
    }
  },7000);
}

function toggleFullscreen(id){const el=document.getElementById(id);if(!document.fullscreenElement) el.requestFullscreen(); else document.exitFullscreen();}

async function route(){
  const app=document.getElementById("app");
  const h=location.hash||"#/";
  if(h==="#/") app.innerHTML=homePage();
  else if(h==="#/games") app.innerHTML=gamesPage();
  else if(h.startsWith("#/game/")) app.innerHTML=await gamePage(parseInt(h.split("/")[2]));
}

setInterval(()=>{const t=document.getElementById("time");if(t)t.textContent=getTime();},1000);
window.addEventListener("hashchange",route);
loadGames();
</script>
</body>
</html>
